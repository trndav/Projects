{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <title>{% block title %}TwitterApp{% endblock %}</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link href="{% static 'twitterapp/styles.css' %}" rel="stylesheet">
        

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                document.querySelectorAll('.like-btn').forEach(function(button) {
                    button.addEventListener('click', function() {
                        event.preventDefault(); // Prevent default form submission behavior
                        const postId = this.dataset.postId;
                        fetch(`/like/${postId}/`, {
                            method: 'POST',
                            headers: {
                                'X-CSRFToken': '{{ csrf_token }}',
                            },
                        })
                        .then(response => {
                            if (response.ok) {
                                return response.text(); // Extract the response text
                            } else {
                                throw new Error('Network response was not ok.');
                            }
                        })
                        .then(data => {
                            // Update the like count in the DOM
                            const likeCountElement = document.getElementById(`likes_count_${postId}`);
                            if (likeCountElement !== null) {
                                likeCountElement.textContent = data; // Update the like count
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    });
                });
            });

            // Pagination
//             document.addEventListener('DOMContentLoaded', function() {
//     // Check if the current page URL contains 'posts_view'
//     if (window.location.href.includes('/get_paginated_posts?')) { //(window.location.href.includes('') || 
//         console.log('Executing JavaScript for posts_view page');
//         let currentPage = 1;
//         let totalPages = 1;

//         function loadPosts(page) {
//             currentPage = page;
//             fetch(`/get_paginated_posts?page=${page}`)
//                 .then(response => response.json())
//                 .then(data => {
//                     // Update page content with fetched posts data
//                     const postsContainer = document.getElementById('posts-container');
//                     postsContainer.innerHTML = ''; // Clear existing posts
//                     data.posts.forEach(post => {
//                         const postElement = document.createElement('div');
//                         postElement.className = 'col-sm-10';
//                         postElement.innerHTML = `
//                             ${post.text}<br>
//                             <i><span id="font_small">Posted by <b><a href="user/${post.user}">${post.user}</a></b> on ${post.created_at}</i></span><br>  
//                             <span class="font_small" id="likes_count_${post.id}">${post.total_likes}</span> <span class="font_small"> likes</span>
//                             ${data.is_authenticated ? `<button class="like-btn" data-post-id="${post.id}">Like</button>` : ''}
//                             <hr>
//                         `;
//                         postsContainer.appendChild(postElement);
//                     });

//                     // Update pagination buttons
//                     const paginationContainer = document.getElementById('pagination-container');
//                     paginationContainer.innerHTML = '';
//                     const previousBtn = document.createElement('button');
//                     previousBtn.id = 'previous-btn';
//                     previousBtn.textContent = 'Previous';
//                     // previousBtn.disabled = currentPage === 1; // Disable previous button if on first page
//                     if (currentPage === 1) {
//                         previousBtn.style.display = 'none';
//                     } else {
//                         previousBtn.style.display = 'inline-block';
//                     }
//                     previousBtn.addEventListener('click', () => loadPosts(currentPage - 1));
//                     previousBtn.style.marginRight = '10px';
//                     previousBtn.classList.add('btn-primary');

//                     const nextBtn = document.createElement('button');
//                     nextBtn.id = 'next-btn';
//                     nextBtn.textContent = 'Next';
//                     // nextBtn.disabled = currentPage === totalPages; // Disable next button if on last page
//                     if (currentPage === totalPages) {
//                         nextBtn.style.display = 'none';
//                     } else {
//                         nextBtn.style.display = 'inline-block';
//                     }
//                     nextBtn.addEventListener('click', () => loadPosts(currentPage + 1));
//                     nextBtn.style.marginLeft = '10px';
//                     nextBtn.style.marginBottom = '10px';
//                     nextBtn.classList.add('btn-primary');

//                     // Container for buttons to center them
//                     const buttonContainer = document.createElement('div');
//                     buttonContainer.style.width = '100%';
//                     buttonContainer.style.textAlign = 'center';
//                     // Add buttons to container
//                     buttonContainer.appendChild(previousBtn);
//                     buttonContainer.appendChild(nextBtn);
//                     paginationContainer.appendChild(buttonContainer);
//                 });
//         }

//         // Initial load
//         fetch('/get_paginated_posts?page=1')
//             .then(response => response.json())
//             .then(data => {
//                 totalPages = calculateTotalPages(data.total_posts, 5); // Assuming 5 posts per page
//                 loadPosts(currentPage);
//             });

//         // Function to calculate total pages
//         function calculateTotalPages(totalPosts, postsPerPage) {
//             return Math.ceil(totalPosts / postsPerPage);
//         } 
//     } else {
//         console.log('Not on posts_view page');
//     }
    
// });

        </script>
    </head>
    <body>

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="#">TwitterApp</a>          
            <div>
              <ul class="navbar-nav mr-auto">
                {% if user.is_authenticated %}
                    {% if user.is_admin %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'user_page' user.username %}">Admin: <strong>{{ user.username }}</strong></a>
                    </li>
                    {% else %}                    
                    <li class="nav-item">
                        <a class="nav-link" href="#"><strong>{{ user.username }}</strong></a>
                    </li>
                    {% endif %}
                {% endif %}

                <li class="nav-item">
                  <a class="nav-link" href="{% url 'index' %}">All Posts</a>
                </li>
                {% if user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'create_post' %}">Create Post</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'following_users' %}">Following</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'logout' %}">Log Out</a>
                    </li>
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'login' %}">Log In</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'register' %}">Register</a>
                    </li>
                {% endif %}
              </ul>
            </div>
          </nav>
        
        <div class="body">
            {% block body %}
            {% endblock %}
        </div>
    </body>
</html>